/**!
 * Fiddo — A Lightweight, Declarative Field Validator for Modern Forms
 * -------------------------------------------------
 * Version: 1.0
 * Author: Panda Softwares 2025
 *
 * Fiddo is a minimalist, extensible JavaScript library for validating HTML forms
 * using clean, attribute-based syntax. Whether you're building simple forms
 * or complex conditional/grouped validators, Fiddo handles it all — fast, reliable,
 * and dependency-free (except jQuery).
 *
 * Description:
 *   This plugin provides client-side form validation using declarative HTML attributes.
 *   It supports:
 *     - Built-in and custom validators (sync & async)
 *     - Conditional logic (`validate-if`, `not-validate-if`)
 *     - Group field validation (e.g. first + last name combination checks)
 *     - Remote validation via AJAX
 *     - Field-level styling (success/error classes, containers, handlers)
 *     - Auto-initialization with `autoBind` and namespace control
 *     - Configurable plugin name via `window.FiddoPluginName`
 *
 * Features:
 *   - Custom validator registration (`Fiddo.addValidator`)
 *   - Inline and global error messages
 *   - Promise-based validation lifecycle
 *   - Lifecycle event hooks (`form:validated`, `field:error`, etc.)
 *
 * Limitations:
 *   - Requires jQuery
 *   - Assumes flat form structure (no nested object schemas)
 *   - Depends on properly named data attributes (e.g. `data-parsley-required="true"`)
 */
!function(e){"use strict";const t=window.FiddoPluginName||"Fiddo",i=t.toLowerCase(),s={},r={},a=window[`${t}Config`]||{};if(!(e&&e.fn&&e.fn.jquery&&e.expr&&"function"==typeof e.expr.createPseudo&&(e.expr.pseudos||e.expr[":"])))throw new Error("attrStartsWith: requires jQuery with Sizzle selector engine and $.expr.createPseudo support.");if("function"==typeof e.expr.createPseudo){(e.expr.pseudos||e.expr[":"]).attrStartsWith=e.expr.createPseudo((function(e){const t=(e||"").replace(/^["']|["']$/g,"");return function(e){if(!e||1!==e.nodeType||!t)return!1;var i=e.attributes;for(let e=0;e<i.length;e++)if(0===i[e].name.indexOf(t))return!0;return!1}}))}const n={isThenable:e=>e&&("function"==typeof e.then||"function"==typeof e.promise),all:e=>Promise.allSettled(e).then((e=>{const t=e.filter((e=>"rejected"===e.status)).map((e=>e.reason));return t.length?Promise.reject(t):e.map((e=>e.value))})),runSequential:function(e){const t=[],i=[];let s=0;return function r(){if(s>=e.length)return i.length?Promise.reject(i):Promise.resolve(t);let a;try{a=("function"==typeof(n=e[s++])?n:()=>n)()}catch(e){return i.push(e),Promise.reject(i)}var n;return Promise.resolve(a).then((e=>(t.push(e),r())),(e=>(i.push(e),Promise.reject(i))))}()},namespaceEvents(e,t){const s=e.split(/\s+/).filter(Boolean),r=t||`${i}Field`;return s.map((e=>`${e}.${r}`)).join(" ")},_extends(...e){let t=!1;const i=[];for(let s of e)!0===s?t=!0:"object"==typeof s&&null!==s&&i.push(s);const s=i.shift()||{};for(const e of i)for(const i in e){const r=e[i];t&&r&&"object"==typeof r&&!Array.isArray(r)?(s[i]&&"object"==typeof s[i]||(s[i]={}),this._extends(s[i],!0,r)):s[i]=r}return s},cloneValue:e=>Array.isArray(e)?e.slice():e&&"object"==typeof e?{...e}:e,formatMessage(e,t){if(e){if("object"==typeof t){for(let i in t)e=this.formatMessage(e,t[i]);return e}return"string"==typeof e?e.replace(/%s/i,t):""}},getAttr:(e,t,i)=>e.getAttribute(t+i),generateID:e=>(s[e]=(s[e]||0)+1,""+s[e]),getElementId(e){const t=e.tagName.toLowerCase();return e.id||this.parseInputName(e.name)||`${t}${this.generateID(t)}`},getId(e){return e.id||this.parseInputName(e.name)||e.tagName.toLowerCase()},isSelector:e=>e&&"string"==typeof e&&/^([#.][\w-]+|\[[^\]]+\]|[a-zA-Z][\w-]*)$/.test(e),arraysEqual:(e,t)=>Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(((e,i)=>e===t[i])),areEquals(e,t){return Array.isArray(e)&&Array.isArray(t)?this.arraysEqual(e,t):e===t},debounceCall(e,t,i,s){i?(window.clearTimeout(e[t]),e[t]=window.setTimeout(s,i)):s()},isElementVisible:e=>(e.is("select.selectized")&&(e=e.siblings(".selectize-control")),!!(e[0].offsetWidth||e[0].offsetHeight||e[0].getClientRects().length)),eventTypeMatches:(e,t)=>e&&e.type&&t.trim().split(/\s+/).includes(e.type),parseFloatRequirement:t=>isNaN(+t)?parseFloat(e(t).val()):+t,serialize:e=>Array.isArray(e)?"["+e.join(",")+"]":e,deserialize(e){if(e=e?.trim(),!e)return"";let t;try{if(/^[\[\{]/.test(e)){if(!/^\[[a-zA-Z_]+\s*,\s*[a-zA-Z_]+\]$/.test(e)){let t=e.replace(/'/g,'"').replace(/([{,]\s*)([a-zA-Z_][a-zA-Z0-9_]*)(\s*:)/g,'$1"$2"$3').replace(/:\s*(?=[,}])/g,':""');return JSON.parse(t)}{const t=e.match(/^\[\s*(.*?)\s*\]$/);if(t){const e=t[1];return e.split(",").map((e=>e.trim())).filter(Boolean)}}}return"true"==e||"false"!=e&&("null"==e?null:isNaN(t=Number(e))?e:t)}catch(t){return e}},parseInputName(e){if("string"!=typeof e||!e.length)return"";if(!e.includes("["))return e.trim();const t=[],i=/([^\[\]]+)|\[(.*?)\]/g;let s;for(;null!==(s=i.exec(e));){const e=void 0!==s[2]?s[2]:s[1];e&&e.trim()&&t.push(e.trim())}return t.length>1&&t.shift(),t.join("_")},flashClass(e,t,i=500){e&&e.length&&(e.addClass(t),setTimeout((()=>e.removeClass(t)),i))},camelize:e=>e.replace(/-+(.)?/g,((e,t)=>t?t.toUpperCase():"")),isStringOrArray:e=>"string"==typeof e||Array.isArray(e),toArray:e=>[].concat(e||[]),size:e=>Array.isArray(e)?e.length>0:e&&"object"==typeof e?Object.keys(e).length:"string"==typeof e?e.length:0,empty(e){return!this.size(e?.toString().trim())},_isDiscreteControl:e=>e.is('select, input[type="checkbox"], input[type="radio"], input[type="file"]'),resolveTargetElement(t,i=void 0){return t?("string"==typeof t&&(n.isSelector(t)?t=e(t):"function"==typeof window[t]&&(t=window[t])),"function"==typeof t&&(t=t.call(this,this)),t instanceof HTMLElement&&(t=e(t)),t&&t.jquery&&t.length?t:i):i},isDateStr:e=>e&&"string"==typeof e&&/^(?:\d{1,2}([\/\-.])\d{1,2}\1\d{4}|\d{4}([\/\-.])\d{1,2}\2\d{1,2})$/.test(e),parseDateWithFormat(e,t){if("string"!=typeof e)return null;if("string"==typeof t&&t.trim()||(t="MM/DD/YYYY"),t.length!==e.length)return null;const i=t.match(/[^A-Za-z]/);if(!i)return null;const s=i[0],r=t.split(s),a=e.split(s);if(r.length!==a.length)return null;const n={day:null,month:null,year:null},l={D:"day",DD:"day",M:"month",MM:"month",YY:"year",YYYY:"year"};for(let e=0;e<r.length;e++){const t=r[e],i=a[e];if("MMMM"===t){const e=getMonthIndex(i);if(-1===e)return null;n.month=e+1;continue}const s=l[t];if(!s)return null;let o=parseInt(i,10);"YY"===t&&(o=2e3+o),n[s]=o}const{day:o,month:d,year:u}=n;if(!o||!d||!u)return null;const h=new Date(u,d-1,o);return h.getFullYear()===u&&h.getMonth()===d-1&&h.getDate()===o?h:null},warn(...e){"undefined"!=typeof window&&window.console&&"function"==typeof window.console.warn&&window.console.warn(`[${t}]`,...e)},debug(...e){!0===a?.debug&&"undefined"!=typeof window&&window.console&&"function"==typeof window.console.debug&&window.console.debug(`[${t}]`,...e)},error(...e){"undefined"!=typeof window&&window.console&&"function"==typeof window.console.error&&window.console.error(`[${t}]`,...e)}},l=n._extends(!0,{defaultMessage:"This value seems to be invalid.",type:{email:"This value should be a valid email address.",url:"This value should be a valid url.",number:"This value should be a valid number.",integer:"This value should be a valid integer.",digits:"This value should be digits.",alphanum:"This value should be alphanumeric.",color:"Please select a valid color.",date:"Please enter a valid date.",datetime:"Please enter a valid date and time.","datetime-local":"Please enter a valid local date and time.",file:"Please upload a valid file.",image:"Please upload a valid image.",month:"Please enter a valid month.",password:"Please enter a valid password.",range:"Please select a valid range.",tel:"Please enter a valid telephone number.",time:"Please enter a valid time.",week:"Please enter a valid week."},notblank:"This value should not be blank.",required:"This value is required.",minrequired:"At least %s input(s) are required.",pattern:"This value seems to be invalid.",min:"This value should be greater than or equal to %s.",max:"This value should be lower than or equal to %s.",range:"This value should be between %s and %s.",minlength:"This value is too short. It should have %s characters or more.",maxlength:"This value is too long. It should have %s characters or fewer.",length:"This value length is invalid. It should be between %s and %s characters long.",mincheck:"You must select at least %s choices.",maxcheck:"You must select %s choices or fewer.",check:"You must select between %s and %s choices.",equalto:"This value should be the same.",notequalto:"This value should be different.",gt:"This value should be greater than %s.",gte:"This value should be greater than or equal to %s.",lt:"This value should be less than %s.",lte:"This value should be less than or equal to %s.",euvatin:"It's not a valid VAT Identification Number.",money:"Please enter a valid amount greater than zero",date:"The entered date is invalid (expected format: %s)",datemin:"The date cannot be earlier than %s",datemax:"The date cannot be later than %s",datepast:"The date cannot be in the future",datefuture:"The date cannot be in the past"},a.Messages),o={namespace:`data-${i}-`,inputs:"input, textarea, select",excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden], .selectize-input > input, novalidate",validationThreshold:3,focus:"first",focusClass:`${i}-glow`,trigger:!1,triggerAfterFailure:"input",errorClass:`${i}-error`,successClass:`${i}-success`,stopAtFirstError:!0,showMultipleErrors:!1,classHandler:function(e){if(e.$element.is("select.selectized"))return e.$element.siblings(".selectize-control")},errorsWrapper:'<ul class="parsley-errors-list"></ul>',errorTemplate:"<li></li>",successTemplate:"",defaultAjaxMethod:"GET"};class d extends Error{constructor({assert:e,message:t}){super(t),this.name="ValidationError",this.assert=e,this.errorMessage=t}static from(e,t){return new d({assert:e,message:t})}}class u{constructor({name:e,validateFn:t,message:i,group:s,priority:r=0}){this.name=e,"function"==typeof t&&(this.validateFn=t),this.message=i||l[e]||"Validation failed",this.group=s,this.priority=r}_reject(e,t){const i=n.formatMessage(e?.message||e||this.message,t);return Promise.reject(d.from(this.name,i))}validate(e,i,s){const r=this.validateFn;if("function"!=typeof r)throw new Error(`${t} Validator:${this.name} : no validate function defined`);try{const t=Array.isArray(i)?[e,...i,s]:[e,i,s],a=r.apply(s,t);return n.debug(`Validator ${this.name} : validator returns \`${a}\` for value \`${e}\``),n.isThenable(a)?Promise.resolve(a).catch((e=>this._reject(e,i))):a?Promise.resolve():this._reject(s.customErrorMessage||this.message,i)}catch(e){throw console.error(`${t} Error in validator "${this.name}":`,e),e}}}class h extends u{constructor(e,i){const s=F[e];if(super({name:e,message:p(e,void 0,i),priority:"object"==typeof s&&"number"==typeof s.priority?s.priority:0}),"object"==typeof s){const r=n.deserialize(s.requirementType);if(n.isStringOrArray(r)&&!this._validateRequirementType(i,r))throw new Error(`[${t}] StandardValidator "${e}": Expected requirement of type "${n.serialize(r)}", got "${n.serialize(i)}"`);if("function"!=typeof s.validate)throw new Error(`[${t}] StandardValidator "${e}": Undefined validateFn`);this.validateFn=s.validate}else{if("function"!=typeof s)throw new Error(`[${t}] StandardValidator "${e}": Undefined validateFn`);this.validateFn=s}this.requirement=i}_validateRequirementType(e,i){if(!i)return!0;const s=n.toArray(e),r=n.toArray(i);return s.length===r.length&&s.every(((e,i)=>r[i].split("|").map((e=>e.trim())).some((i=>{const s=y[i];if(!s||"function"!=typeof s.test)throw new Error(`[${t}] Unknown requirement type "${i}" in validator.`);return s.test(e)}))))}}class c extends u{constructor({name:e,message:t,group:i,url:s,method:r,dataKey:n,isValidFn:l=null,priority:o=10,preValidateFn:d=null,successMessageFn:u=null,errorMessageFn:h=null}){super({name:e,message:t,group:i,priority:o}),this.url=s,this.method=r||a.defaultAjaxMethod,this.dataKey=("*"==n?this.name:n)||"value",this.validateFn=this.validateFn.bind(this),this.isValidFn=(l||this.defaultIsValidFn).bind(this),this.preValidateFn="function"==typeof d?d.bind(this):null,this.successMessageFn="function"==typeof u?u.bind(this):null,this.errorMessageFn="function"==typeof h?h.bind(this):null}defaultIsValidFn(e,t,i){return i?.status>=200&&i?.status<300}validateFn(i,s,r){this.preValidateFn&&0==this.preValidateFn(i)&&Promise.resolve(!0);const a=this.url||"string"==typeof s&&s||s&&s.url;if(!a)return console.error(`[${t}] RemoteValidator "${this.name}": no URL resolved from spec or requirement`),Promise.resolve(!1);const l=s&&s.extra||{};r.$element.addClass("ajax-loading");const o=r instanceof g?{...(()=>{const e={};return r.fields.forEach(((t,i)=>{e[t._name]=t.getValue()})),e})(),...l}:{[this.dataKey]:i,...l};return new Promise(((s,l)=>{e.ajax({url:a,method:this.method,data:o}).done(((e,r,a)=>{let o=!1;try{o="function"==typeof this.isValidFn&&!!this.isValidFn(e,r,a),n.debug(`Remote validation is ${o}, response:`,e)}catch(e){return console.error(`${t} RemoteValidator isValidFn threw an error:`,e),void l(e)}o?s({successMessage:this.successMessageFn&&this.successMessageFn({data:e,values:i})||e?.successMessage}):l(this.errorMessageFn&&this.errorMessageFn({data:e,values:i})||e?.errorMessage||this.message)})).fail(((e,t,i)=>{l(i||t||"Remote validation failed")})).always((function(){r.$element.removeClass("ajax-loading")}))}))}}function p(e,t,i){const s=("object"==typeof l[e]?l[e]?.[i]:l[e])||l.defaultMessage;return t?n.formatMessage(s,t):s}class m{constructor(e,t,i){this.field=e,this.name=t,this.requirements=i,this._buildValidator(),this.priority=this.validator?.priority??0}_buildValidator(){r[this.name]?(this.validator=r[this.name],this.validator.group&&(this.field.isGroupField=!0)):m.isStandardConstraint(this.name,this.requirements)?this.validator=new h(this.name,this.requirements):n.warn(`Constraint in field \`${this.field.__id__}\` - no validator found for name ${this.name}`)}static isStandardConstraint(e,t){return!!F[e]&&("type"!==e||"string"==typeof t&&Object.prototype.hasOwnProperty.call(y,t))}static isValidConstraint(e,t){return void 0!==r[e]||m.isStandardConstraint(e,t)}validateConstraint(e){if(!this.validator)throw new Error("Validator not found");return n.debug(`Constraint:${this.name} field:${this.field.__id__} validate with value:${e} requirements:${this.requirements}`),this.validator.validate(e,this.requirements,this.field)}}class f{constructor(t,i,s,r){this.element=t,this.$element=e(t),this.form=i,this.options=s,this.constraints={},this._lastValidatedValue=null,this._lastValidationState=null,this._lastShouldValidate=null,this._failedOnce=!1,this.__id__=n.getElementId(this.element),this._name=n.parseInputName(this.element.name)||this.__id__,this._isChoiceInput=/^(checkbox|radio)$/i.test(this.element.type),this._parentGroup=r,this._isValid=!1,this._actualizeConstaints()}_actualizeConstaints(){this._bindConstraints(),this._bindEvents()}_hasParentGroup(){return this._parentGroup&&this._parentGroup instanceof g}_getAttr(){const e={},t=this.element.attributes;for(let i=t.length;i--;){const s=t[i],r=s.name.toLowerCase(),a=s.value.trim();s&&s.specified&&(s.name.startsWith(this.options.namespace)?e[n.camelize(s.name.slice(this.options.namespace.length))]=n.deserialize(s.value):r.startsWith("data-")?e[n.camelize(s.name.slice(5))]=n.deserialize(s.value):m.isStandardConstraint(r,a)&&(e[r]=a))}return e}_bindConstraints(){const e=this._getAttr();this.domOptions={};const t=new Set,i=(e,i)=>{const s=_[e];return!(!s||!i.hasOwnProperty(s.dualAttr)||t.has(s.dualAttr))&&s};for(const[s,r]of Object.entries(e))if(!t.has(s))if(m.isValidConstraint(s,r)){const a=i(s,e);if(a){const i={[s]:r,[a.dualAttr]:e[a.dualAttr]},l=n.deserialize(F[a.dualName].dual).map((e=>i[e]));m.isValidConstraint(a.dualName,l)&&(this.addConstraint(a.dualName,l),t.add(a.dualAttr))}else this.addConstraint(s,r)}else this.domOptions[s]=r}_triggerForElement(){return n._isDiscreteControl(this.$element)?"change":(this._failedOnce?this.options.triggerAfterFailure:this.domOptions.trigger||this.options.trigger)||"input"}_bindEvents(){const e=i+"Field";this.$element.off("."+e);const t=this._triggerForElement();this instanceof g||this.$element.on(n.namespaceEvents(t,e),(e=>{this._validateIfNeeded(e)}))}_validateIfNeeded(e){n.debug(`[${this.__id__}] _validateIfNeeded event type:${e?.type} value:${this.getValue()}`),n.debounceCall(this,"_debounced",this.options.debounce,(t=>this._silentValidate(e)))}_silentValidate(e){const t=this._lastValidationState,i=()=>{const i=t!==this._lastValidationState,s=n.eventTypeMatches(e,"change blur");if(this._hasParentGroup()&&(i||s)){this._parentGroup.fields.some((e=>null===e._lastValidationState&&!e.isChoiceInput))||this._parentGroup.queueValidateFromChild(this,e)}};this.whenValidate().then((()=>{i()})).catch((e=>{if(e instanceof f)i();else if(e instanceof Error)throw e}))}addConstraint(e,t){n.debug(`Field \`${this.__id__}\` : adding constraint:${e} requirements:${t}`);const i=new m(this,e,t),s=this.domOptions[`${e}Message`];if(s?.length)if(s.startsWith("@")){const e=s.slice(1);i.validator.message=l[e]||s}else i.validator.message=s;this.constraints[e]=i}shouldValidate(){const i=this.domOptions.validateIf,s=this.domOptions.notValidateIf,r=i=>{if(void 0===i)return!0;try{if(n.isSelector(i)){const s=e(i);if(!s.length)throw new Error(`[${t}] validate-if selector "${i}" did not match any elements.`);if(s.is(":checkbox"))return s.is(":checked");if(s.is("select")){const e=s.val();return Array.isArray(e)?e.length>0:!!e}return!!s.val()}if("string"==typeof i&&"function"==typeof window[i])return window[i](this);if("string"==typeof i)return Function('"use strict";return ('+i+")")();if("function"==typeof i)return i.call(this)}catch(e){return n.warn("Error evaluating validate-if condition:",e),!1}return!0},a=void 0===i||r(i),l=void 0!==s&&r(s);return a&&!l}_buildValidationsFor(e){const t=Object.values(this.constraints).sort(((e,t)=>(t.priority??0)-(e.priority??0)));n.debug(`Validation order for ${this.__id__}:`,t.map((e=>`${e.name??"(anon)"}@${e.priority??0}`)).join("  →  "));const i=this.options?.stopAtFirstError?t=>()=>t.validateConstraint(e):t=>t.validateConstraint(e);return t.map(i)}_preValidate(){return Promise.resolve()}whenValidate(){const e=this.getValue(),t=t=>(!1===this._lastValidationState&&this._handleUI(!0),t&&this._trigger("success",{field:this}),this._lastValidationState=!0,this._isValid=!0,Promise.resolve(e)),i=this._lastShouldValidate,s=this.shouldValidate();return this._lastShouldValidate=s,i===s&&n.areEquals(e,this._lastValidatedValue)&&null!==this._lastValidationState?this._lastValidationState?Promise.resolve(e):Promise.reject(this):(this.validationResult=[],this._lastValidatedValue=n.cloneValue(e),!this._isChoiceInput&&this.shouldValidate()&&n.size(this.constraints)&&n.isElementVisible(this.$element)?n.empty(e)&&!this._isRequired()?t(!1):Promise.resolve(this._preValidate()).then((t=>{const i=this._buildValidationsFor(e);return this._finalizeValidationResult(e,i)})):t(!1))}_getSuccessValidationMessage(e,t){const i=this.domOptions.successMessage||(t||[]).map((e=>"string"==typeof e?e:e?.successMessage)).find(Boolean)||null;return n.formatMessage(i,e)}_finalizeValidationResult(e,t){return(this.options?.stopAtFirstError?n.runSequential:n.all)(t).then((t=>(this.validationSuccessMessage=this._getSuccessValidationMessage(e,t),this.validationResult=null,this._handleUI(!0),this._trigger("success",[{field:this}]),this._lastValidationState=!0,e))).catch((e=>{if(!(e instanceof Error))return this.validationSuccessMessage=null,this.validationResult=e,this._handleUI(!1),this._trigger("error",[{field:this}]),this._lastValidationState=!1,Promise.reject(this);n.error(e.message)})).finally((()=>{this._trigger("validated",[{field:this,isValid:this._isValid}])}))}getValue(){return/^(checkbox|radio)$/i.test(this.element.type)?this.element.checked:this.element.value}_isRequired(){return this.constraints.required&&!1!==this.constraints.required.requirements}_insertErrorWrapper(){if(!this.$errorsWrapper){this.$errorsWrapper=e(this.options.errorsWrapper).attr("id",`${this.options.namespace}error-list-${this.__id__}`);const t=this._getErrorContainer();t?.length?t.append(this.$errorsWrapper):this._getClassHandler().after(this.$errorsWrapper)}return this.$errorsWrapper}_getErrorWrapper(){return this.$errorsWrapper}_getClassHandler(){return n.resolveTargetElement.call(this,this.domOptions.classHandler||this.options.classHandler,this.$element)}_getErrorContainer(){return n.resolveTargetElement.call(this,this.domOptions.errorsContainer||this.options.errorsContainer)}_handleUI(t){this._isValid=t;const i=this._getClassHandler();i.attr("aria-invalid",!t).toggleClass(this.options.successClass,t).toggleClass(this.options.errorClass,!t).removeAttr("aria-describedby");let s=this._getErrorWrapper();s&&s.empty().removeClass("filled").attr("aria-hidden","true").removeAttr("role aria-live");const r=t&&this.validationSuccessMessage,a=!t&&Array.isArray(this.validationResult)&&this.validationResult.length>0,n=r||a;if(n&&(s=this._insertErrorWrapper(),i.attr("aria-describedby",s.attr("id"))),a){this._failedOnce||(this._failedOnce=!0,this._bindEvents());const t=this.validationResult.sort(((e,t)=>"required"===e.assert?-1:"required"===t.assert?1:0)),i="required"!==t[0].assert&&this.options.showMultipleErrors?t:[t[0]];for(const t of i){const i=e(this.options.errorTemplate).html(t.errorMessage).attr(`data-error-${t.assert}`,"");s.append(i)}}if(r){const t=e(this.options.successTemplate||this.options.errorTemplate).html(this.validationSuccessMessage).attr("data-success","").addClass(`${this.options.namespace}success-message`);s.append(t)}n&&s.addClass("filled").attr({"aria-hidden":"false",role:a?"alert":"status","aria-live":"polite"})}_neutralizeUI(){this.validationResult=[],this.validationSuccessMessage=null,this._lastValidatedValue=null,this._lastValidationState=null,this._lastShouldValidate=null,this._isValid=!1,this.$errorsWrapper&&this.$errorsWrapper.empty().removeClass("filled").attr("aria-hidden","true").removeAttr("role aria-live"),this._getClassHandler().removeClass(this.options.successClass).removeClass(this.options.errorClass).removeAttr("aria-invalid aria-describedby")}reset(){this._failedOnce=!1,this._neutralizeUI(),this._bindEvents()}destroy(){this.$element.off(`.${t}Field`),this.$errorsWrapper&&(this.$errorsWrapper.remove(),this.$errorsWrapper=null),this.constraints={},this._lastValidatedValue=null,this._lastValidationState=null,this._failedOnce=!1,this._isValid=!1}refresh(){this.destroy(),this._actualizeConstaints()}_trigger(e,...t){return this.$element.trigger(`field:${e}`,t)}}class g extends f{fields=[];constructor(e,t,i){super(e,t,i),e.classList.add("group-field"),this._collectGroupFields()}_collectGroupFields(){this.fields=[];let e=null;const t=new Set;let i=!1;this.form._getCandidateElements(this.$element).each(((e,s)=>{n.debug(`FieldGroup : collecting child element \`${n.getElementId(s)}\``);const r=new f(s,this,this.options,this);this.fields.push(r);const a=(s.type||"").toLowerCase();"checkbox"===a||"radio"===a?t.add(a):i=!0})),e=i||1!==t.size?null:t.values().next().value,this.multipleType=e}_containsField(e){return this.fields.some((t=>t.element===e))}_preValidate(){if(!this.fields||0===this.fields.length)return n.debug(`[${this.__id__}] _preValidate: no child fields`),Promise.resolve();if(this.fields.some((e=>!1===e._lastValidationState)))return Promise.reject(this);const e=this.fields.filter((e=>null===e._lastValidationState||!n.areEquals(e.getValue(),e._lastValidatedValue)));if(0===e.length){return this.fields.every((e=>!0===e._lastValidationState))?Promise.resolve():Promise.reject(this)}return(this.options?.stopAtFirstError?n.runSequential:n.all)(this.options?.stopAtFirstError?e.map((e=>()=>e.whenValidate())):e.map((e=>e.whenValidate()))).then((e=>e)).catch((e=>{if(e instanceof Error)throw e;return Promise.reject(this)}))}queueValidateFromChild(e,t){n.debounceCall(this,"_groupDebounced",this.options.debounce||50,(()=>{if(0==this._lastValidationState){if(this.fields.some((e=>!1===e._lastValidationState)))return void this._neutralizeUI()}this.whenValidate().catch((()=>{}))}))}getValue(){switch(this.multipleType){case"checkbox":return this.fields.filter((e=>e.element.checked)).map((e=>e.element.value));case"radio":const e=this.fields.find((e=>e.element.checked));return e?e.element.value:"";default:return this.fields.map((e=>e.getValue()))}}destroy(){this.fields.forEach((e=>e.destroy?.())),super.destroy()}refresh(){this.destroy(),this._collectGroupFields(),this._bindEvents()}}class v{constructor(t,s={}){this.element=t,this.$element=e(t),this.options=s,this.fields=[],this.$element.attr("novalidate","").addClass(i),this.$element[i]=!0,this._bindSubmit(),this._bindFields(),this._trigger("init",{form:this})}_submit(t,i){const s=e.Event("submit",{originalEvent:t,valid_submit:!0,submitter:i});this.$element.trigger(s),n.debug("Form submitted",s)}_bindSubmit(){this.$element.on(`submit.${t}`,(e=>{if(e.valid_submit)return;e.preventDefault(),e.stopImmediatePropagation();const t=e.originalEvent?.submitter||document.activeElement||null;return this.whenValidate().then((i=>{this._trigger("success"),!1!==this._trigger("submit",{event:e},t)&&this._submit(e,t)})).catch((e=>{this._trigger("error"),this.focus(e)})),!1}))}_getCandidateElements(e,t=""){const i=this.options.inputs+(t?","+t:"");return e.find(i).not(this.options.excluded).not(`[${this.options.namespace}excluded=true]`)}_addFieldsFromElements(t){let i=null;t.forEach((t=>{if(n.debug(`Form : collecting form element \`${n.getId(t)}\``),i&&i._containsField(t))return void n.debug(`Form : skipping form element \`${n.getId(t)}\` already in group \`${i.__id__}\``);let s;s=e(t).is("input, textarea, select")?new f(t,this,this.options):i=new g(t,this,this.options),this.fields.push(s)}))}_bindFields(){this.fields=[];const e=this._getCandidateElements(this.$element,`:attrStartsWith(${this.options.namespace})`);this._addFieldsFromElements(e.toArray())}whenValidate(){this._trigger("validate");const e=this.fields.map((e=>e.whenValidate()));return n.all(e).then((e=>(this._trigger("validated"),e))).catch((e=>(this._trigger("error"),Promise.reject(e))))}validate(){return this.whenValidate().then((e=>!0)).catch((e=>!1))}focus(t){if(!t.length)return;const i=t[0];let s=null;if(i instanceof g&&i.fields.length>0){s=(i.fields.find((e=>!0!==e._isValid))||i.fields[0]).element}else s=i.element;"SELECT"===s.tagName&&s.selectize&&s.selectize instanceof Selectize&&(s=s.selectize),s&&"function"==typeof s.focus&&(s.focus(),this.options.focusClass&&n.flashClass(e(s),this.options.focusClass,500))}_trigger(e,...t){return this.$element.trigger(`form:${e}`,t)}reset(){this.fields.forEach((e=>e.reset()))}refresh(){this.fields.map((e=>e.element)),this._getCandidateElements(this.$element,`:attrStartsWith(${this.options.namespace})`).toArray();this.destroy(),this._bindFields(),this._trigger("refreshed",{form:this})}destroy(){this.fields.forEach((e=>e.destroy?.())),this.$element.off(`.${t}`),this.$element.removeData(t),this.fields=[],this._trigger("destroy")}}const y={number:{test:function(e){return!0}},email:/^((([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))$/,date:{test:function(e){const t=new Date(e);return!isNaN(t.getTime())}},tel:{test:function(e){if("*"===(e=e.trim()))return!0;return/^(?:\+41|0041|0)(?:\s?)([2-9]{2})(?:\s?\d{3})(?:\s?\d{2})(?:\s?\d{2})$/.test(e)||/^(?:\+|00)([1-9]\d{0,3})(?:\s?\d){6,14}$/.test(e)}},url:new RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-zA-Z\\u00a1-\\uffff0-9]-*)*[a-zA-Z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-zA-Z\\u00a1-\\uffff0-9]-*)*[a-zA-Z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-zA-Z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/\\S*)?$"),selector:/^([#.][\w-]+|\[[^\]]+\]|[a-zA-Z][\w-]*)$/,regexp:{test:function(e){try{return/^\^.*\$$/.test(e.trim())&&!!new RegExp(e)}catch(e){return!1}}},integer:/^-?\d+$/,digits:/^\d+$/,alphanum:/^\w+$/i};y.range=y.number;const F={required:{validate:e=>!n.empty(e),priority:100},minrequired:{validate:(e,t)=>e.filter((e=>!!e?.trim())).length>=(parseInt(t)||0),requirementType:"integer",priority:50},pattern:{validate:(e,t)=>new RegExp(t).test(e),requirementType:"regexp",priority:70},min:{validate:(e,t)=>parseFloat(e)>=parseFloat(t),requirementType:"number",priority:60},max:{validate:(e,t)=>parseFloat(e)<=parseFloat(t),requirementType:"number",priority:60},range:{validate:(e,t,i)=>parseFloat(e)>=parseFloat(t)&&parseFloat(e)<=parseFloat(i),requirementType:"[number,number]",dual:"[min,max]",priority:61},minlength:{validate:(e,t)=>e.length>=parseInt(t,10),requirementType:"integer",priority:50},maxlength:{validate:(e,t)=>e.length<=parseInt(t,10),requirementType:"integer",priority:50},length:{validate:(e,t,i)=>e.length>=parseInt(t,10)&&e.length<=parseInt(i,10),requirementType:"[integer,integer]",dual:"[minlength,maxlength]",priority:51},equalto:{validate:(e,t)=>parseFloat(e)==n.parseFloatRequirement(t),requirementType:"number|selector",priority:40},notequalto:{validate:(e,t)=>parseFloat(e)!=n.parseFloatRequirement(t),requirementType:"number|selector",priority:40},gt:{validate:(e,t)=>parseFloat(e)>n.parseFloatRequirement(t),requirementType:"number|selector",priority:40},gte:{validate:(e,t)=>parseFloat(e)>=n.parseFloatRequirement(t),requirementType:"number|selector",priority:40},lt:{validate:(e,t)=>parseFloat(e)<n.parseFloatRequirement(t),requirementType:"number|selector",priority:40},lte:{validate:(e,t)=>parseFloat(e)<=n.parseFloatRequirement(t),requirementType:"number|selector",priority:40},mincheck:{validate:(e,t)=>e.length>=parseInt(t,10),requirementType:"integer",priority:30},maxcheck:{validate:(e,t)=>e.length<=parseInt(t,10),requirementType:"integer",priority:30},check:{validate:(e,t,i)=>e.length>=parseInt(t,10)&&e.length<=parseInt(i,10),requirementType:"[integer,integer]",dual:"[mincheck,maxcheck]",priority:31},date:{validate:function(e,t){return!e.trim()||null!==n.parseDateWithFormat(e.trim(),t)},priority:60},type:{validate:(e,i)=>{const s=y[i];if(!s||"function"!=typeof s.test)throw new Error(`[${t}] Unknown requirement type "${i}" in validator.`);return s.test(e)},priority:70}},_=(()=>{const e={};for(const[t,i]of Object.entries(F))if(i.dual){const[s,r]=n.deserialize(i.dual);e[s]={dualAttr:r,dualName:t},e[r]={dualAttr:s,dualName:t}}return e})();e.fn[i]=function(i){const s=[];return this.each((function(){if(!this.tagName||"form"!==this.tagName.toLowerCase())throw new Error(`[${t}] Initialization must be called on a <form> element.`);let r=e(this).data(t);r?!0===i&&r.reset():(r=new v(this,e.extend(!0,{},o,a,i)),e(this).data(t,r)),s.push(r)})),1===s.length?s[0]:s},!1!==a.autoBind&&a.namespace&&e((function(){const t=e(`[${a.namespace}validate]`);t.length&&"function"==typeof e.fn[i]&&t[i]()})),window[t]={customValidators:r,addValidator:function(e,t){if(e=e.trim(),r[e])return void n.warn(`Validator "${e}" already exists and will not be overwritten.`);let i;i=t instanceof u?t:t.remote||t.url?new c({name:e,...t}):new u({name:e,...t}),r[e]=i},addMessages:function(e){n._extends(l,e)},getErrorMessage:p,Messages:l,Utils:n}}(jQuery);